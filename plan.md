# 遮挡计算流程

1. grid无电过滤
2. 星球遮挡
3. 分辩率0.1过滤
  3.1 不过滤大信号（雷达视角半径超过0.1的信号）
  3.2 decoy信号处理
4. 大信号遮挡过滤
  4.1 decoy信号处理

# 星球遮挡

1. 星球遮挡放在最前？

# decoy优先

1. 在分辩率过滤阶段，decoy信号被认为距离雷达更近，更有可能被选中为代表信号
2. 在分辩率过滤阶段，decoy信号被认为有超过实际大小的默认半径（区分大小方块的decoy），更有可能被认为是大信号不被过滤
3. 在大信号遮挡阶段，decoy信号因为有更近的距离和默认半径，有可能遮挡住decoy释放源


# 其它问题 issues
1. 配置isEw=false 在 半径大于等于30000时必须为true 覆盖customData FIXED
2. 自身飞船没有正确遮挡 FIXED
  - grid的position并不是几何中心
  - 采用 grid.Physics.CenterOfMassWorld
3. 测试小行星的遮挡效果 TODO
4. 原版天线的通信能力时灵时不灵？

# update
## 0.9.1
- FIXED: crash when entity is null
- FEATURE: grid which has more than 20 terminal blocks will be a cover (no matter it has decoy on it or not)
- FIXED: signalRadius error
- FIXED: use grid.Physics.CenterOfMassWorld instead of grid.GetPosition()
- BALANCE: the grid which havs the radar on it will also cover some angle. So better place the KRadar on the edge of the grid. The cover radius is reduced. 

## 0.9.2
fix crash

## 0.9.3
add velocity

# other
- 导弹加油器进行分组，0组只找0组的gyro，1组只找1组的gyro，
  - gyro加参数 只找符合自己tag的
  - 加油器增加参数，1，找哪个分组的mergeblock，2，找merge的半径

- radar脚本输出目标列表（id + 是否高威 + 当前选中）, rgms读取该目标列表，
  - radar 脚本增加 循环选中目标功能，循环全部，最近高威
  - rgms 读取目标列表
  - rgms 每导弹跟踪一个目标ID，丢失目标后导弹自爆
  - 针对当前目标发射一颗导弹
  - 针对所有高威目标发射一颗导弹
  - 测试

- 导弹BUG
  - 发射正上飞 FIXED
  - 转向不足 gyro放宽 TEST
    - 检查转向误差 TEST
  - 基于AE的转向计算 TEST
  - 解除限速后精度不够 TEST
  - 近距模式连打了两发 TODO
  - 程序停止 TEST
    - prepare 数组越界 FIXED

- 导弹AE模式总结
  - 1，用debug模式，把推进器关掉，速度直接设定为向目标飞，专门调转向
  - 2，发现转向gyro的pitch是反的，需要加负号
  - 3，导弹有两级敏感度，第一级是rv（需要消除的速度）对应的角度的倍率，第二级是角度要求下达之后，Gyro转数的倍率
    - 如果是第一级P值过高，则无论如何调节第二级，导弹都只会打圈
  - 增加了方向不齐时减少喷射的设置 （DOT的平方）
    - 注意下限是0.2 否则可能导致慢速转圈的陷阱条件

- KRadar
  - 导弹会遮挡目标信号 DONE
    - 怀疑分辩率问题
    - 分辩率上有多个目标时，优先最大目标

- dcs
  - landing 二阶段折叠 FIXED

- rgms
  - 近距模式连打了两发 TEST

- fcsr
  - 目标观察器 DONE
  - 炮台读radar数据 DONE (KRadar 和 FCS 二选一 不能都用)
  - 当control时 
    - 提供 XY偏移量 DONE
    - 而不是直接失控 DONE
    - 换目标时清偏移量 DONE
    - 提供清偏移量指令 DONE ResetOffset
    - 有目标或无目标时显示/隐藏 瞄准框 DONE

- funnel
  - 每个加目标ID
  - 按当前选择发射

- 造型
  - 用舷窗
  - 霓虹灯

# DCS
- 分组最大满足模式 （理论依据 分组对称抵消副作用） DONE
  - 可动部分为 第一组
  - 氢推第二组 （节省氢气消耗）
  - 尾推第三组
  - 每组都最大满足当前要求 放宽角度要求到 只要有用就推？0.1倍投影以上推？
  - 产生的副作用加成到对后续组的要求上

# 参考资料
- mod blender
  - http://harag-on-steam.github.io/se-blender/
  - 改光照？

# mod block 接收事件
- 锁定偏移位置
- 参考 
  - https://forum.keenswh.com/threads/modders-can-now-create-their-own-terminal-interfaces-how.7384314/
- 查看是否每个KRadar都有Lock的Action DONE

# 设置偏移 读取偏移
- DONE

# 考虑Lock到子网格的问题？
- TODO

# 0220 bug
- 后摆问题？
  - 加日志
  - 加长后摆判定间隔，覆盖震荡 DONE
- 导弹首发命中有问题
  - 减小离舰高度 避免初始误差过大 DONE
  - 调整ATAN参数 0.7比较合适 0.5会振荡 1过于保守修正偏慢 DONE
  - 从瞄准镜看摆动是最简单的办法


# 0221
- 长期计划
  - FCSR 测试
  - RADAR加瞄准转向功能

- 磁轨炮炮台 FCSR
  - 射击精度 与 目标距离成正比 TEST
  - hinge正负反了 判断左右？TEST
  - 调参 正上方没射击？hd? TEST
  - 炮速 TEST
  - 下坠 TEST

- Radar 标记为已摧毁（不输出给FCSR） TEST 4号快捷键

- FCSR fire interval

- 防空炮 TEST
  - 弹速下调

- funnel
  - 预射出距离
  - 左右分开
    - 一侧被消灭 另一侧不会飞过去补
    - 优先发射不足的一侧


# 0402
- radar display 有不知来源的信号
  - 从母舰来的信号，关天线不能关掉信号，要关电
- fcsr不转
  - 进了瞄准台逻辑，即无武器时，又没有select的情况，之前是走attention, 现在改走searchStatbleDir

# 0409
- msc up offset_y


# 0429
- control模式 thrust不听控制？
- l2dam 在有俯仰时考虑俯仰
- down模式 矢量喷口没按下降1.5计算
- standby 模式关闭l2推力

pandeV2整合
演示看我的视频介绍
配置需求，750-2060系列显卡
百度网盘：https://pan.baidu.com/s/17cpm4E0C4XpRxDUKDwCjvg?pwd=khru
夸克网盘：https://pan.quark.cn/s/c1a9766b8c1c
解压码pande1871976531

# 0506
- 导弹解锁conn done
- 导弹refueler conn
- 测试原版雷达 done

# 0507
- 导弹refueler conn done


# 0512
coco 3ba slider presets?
https://www.nexusmods.com/skyrimspecialedition/mods/63816

手柄一键重击？
https://www.nexusmods.com/skyrimspecialedition/mods/72417

coco 浪人
http://www.9damaogames.com/forum.php?mod=viewthread&tid=218629&highlight=coco%2B%C0%CB%C8%CB

ostim?
https://www.nexusmods.com/skyrimspecialedition/articles/3751
https://www.nexusmods.com/skyrimspecialedition/articles/4550


- 转向角速度调整 TODO

- 测试伴飞
- 回归重力内
- 攻击位置？

# 0517
- 视频内容
  - 为什么要做无重力单推 因为6向推已经做过了 单推更有意思
  - 为什么不做双向推
    - 双向推分两种，前后向和下后向。
    - 前后向其实可以理解为省略了调头过程的单推，也就是说两边的推进器不可能同时工作，所以其中一边的推进器必然是浪费的，不考虑
    - 下后向是个很有意思的想法，但是后面我们会看到，实际的转向需求不一定能通过增加下向推进器的方式得到减少
  - 首先，我们的目标是什么，其次，我们的优化方向是什么。
    - 从目标上讲，移动就是一个加速和减速的过程。我们的目标无非是让飞船从A点飞到B点。
    - 当然，如果考虑静参考系，或者均速参考系，问题会比较简单。考虑加速参考系，也就是母船一直加速的情况，问题会比较复杂。我们暂时不考虑。
  - 我们优化的方向，就是尽可能少的转动船体，因为首先转动船体很晕，其次转动船体会带来参考点偏移的自干扰问题。
    - 什么是自干扰？我们把飞船看成一个点，认为转动不改变这个点的位置，然而飞船的参考点是主控坐骑，转动会改变参考点的位置，这就是我称为自干扰的误差。这个误差如果不处理掉，则会导致飞船一直自转。
  - 那么如何达到这个目标呢？我们要回到单向推力能进行全向移动的本质。回顾一下在重力环境下的单向推进器飞行器是如何进行6向移动的？
  - 首先，向上就是推力大于重力，向下就是推力小于重力。而前后左右则是靠偏一点点分量来解决的。
  - 那为什么偏一点点分量就可以解决前后左右的问题呢，因为相较于重力，我们所需要的分量是较小的。比如重力是9.8，我们前后左右有个1或者2就够用了。这样我们算下atan，会发现偏个11度左右就能搞定。
  - 总结一下，如果我们相对于主推进方向，其它方向的分量较小，就可以在较少转动的前提下同时满足这两个需求。
  - 其实这时候很多人应该已经想到了，就算还无重力环境下，如果把从A移动到B这个事情，想像成加速 和 减速 两个阶段，则每个阶段其实也满足上述条件的。
  - 另外可能有人有疑问，如果是单纯的从A到B, 那应该完全没有其它方向的分量呀。这里就不得不考虑误差收敛的概念了。首先，在SE里，并不是我们要一个方向的推力，把飞船转过去，再喷一下，就得到了完全无误差的推力的。在转向到位的那个精确时间点前后进行的喷射都会产生推力分量。甚至之前提到的参考点误差也会产生分量。
  - 我们的思路，不是完全消除误差，而是设计一种过程使得误差会收敛到一个我们可以接受的范围内。
  - 我们可以接收的误差范围有两个硬指标：1，在回收时，可以通过小连接器进行对接。2，在伴飞时，不要距离目标位置太远就行了，比如5米以内是完全可以接受的。
  - 可喜的是，上述这两个目标其实需要的精度并不会特别高，通过适当的算法和路径规划，还是可以完成的。
  - 具体怎么做的，说结论，只要有足够长的路径，就需要足够多的加减速时间，而足够多的加减速时间就提供了足够久的误差收敛窗口。这个长度是多长呢，经过测试，我们示例中的这个小摩托大概需要150米。这个就受制于转动速度，推重比等一系列因素了，其实推重比并非越大越好，因为推重比大了，经过相同的距离所需的时间就更少。但更少的时间可能不足以完成收敛到上述精度目标。
- 上面就是无重力单向推进器的主要概念，为了完成这个概念，我们还会利用到如下机制
  - 1，速度在0.1以下的物体，就算没有推力，也会被SE的引擎强制停止。这个特性非常好，尤其对于强迫症而言，看到自己的飞行器在目标位置速度归零总是好过在目标位置频繁扰动。
  - 2，加速不能加满。一个典型的A到B的过程，是前半程加速，后半程减速。但是这会导致在加减速的切换时，没有足够的时间调转船头。
  - 由于我们使用的是平方根算法，假定飞船推重比。所以我们可以在这个基础上，规定只要是需要加速时，我们忽略掉0.2的加速请求。再规定没有任何加速请求时，飞船默认提前转到减速方向。这样我们就可以挤出中间的一段时间，这段时间需要加速度为0，飞船的推进器不工作，只进行转向调头。
  - 3，转向时考虑向左容易还是向右容易。这点没什么好说的，我们永远往最容易的方向转，避免原地打转。
    - 比如说我们需要往右1度，我们可以往右转1度，也可以往左转359度，但如果我们选择往左转359度。由于转动惯性，我们无法在真的转到目标角度时停下来，一旦转过了，就会需要再来一圈，但是再来一圈还是停不下来的。就会进入一直打转的死循环里。
  - 4，由于转向三个自由度，我们使用了yaw和pitch两个，那么roll这个自由度，我用来对齐母船的roll，这样子船的“上”就是母船的“上”，对于我们习惯在平面上活动的大脑来讲比较友好。同时也能一定程度的避免自扰动误差。

  # 0518
  - 攻击位置
  - 自动停靠 + 打印分配位置

  - radar_display 支持打印
    - startWhenCompiled ini设为false
    - 执行 TurnOn命令

  - afs打印管理功能
    - 1，获取对接器列表，建立对接器缓存数据
    - 2，获取刚打印出来的无人机的radar接口 发送坐标指示 更新对接器使用数据
    - 3，afs接受坐标指示，更新坐标
    - 4，刷新对接器使用数据（在执行完全部停靠程序后）

  光流
  
  - 需要封印石
  - 比价
  https://universalis.app/market/7975
初始4格 后退3格 每层2格

一层右侧 衣服模特 浴池