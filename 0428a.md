每天一个太空工程师编程小知识系列 3，配置数据与进近路径
======================

# 今天我们来聊一个经常被提到的话题，怎么标记进近路径
- 进近路径，就是子船如何接近母船并对接。在AFS中，一条标准的进近路径由3个点组成：伴飞点，进近点，对接点。
- 进近的过程是，子船在从伴飞点飞向进近点，同时调整姿态到对接准备姿态。再从进近点飞向对接点，这个过程中保持进近姿态。
- 而从对接点出发到伴飞点的过程则与上述过程相反，从对接点保持进近姿态，飞向进近点，再飞向伴飞点，在这个过程中调速到伴飞姿态。
- 以前DCS时代，可以设置多个路径点，每个路径点都需要设置姿态。AFS在这个方面进行了简化，虽然还是可以设置多个路径点，但会把最后两个点视为进近点和对接点。
- 在姿态方面，AFS认为伴飞姿态即与母舰同向，不需要设置，只需要设置一个进近姿态即可。进近姿态由子船船头指向标记，有4个选项：前后左右。由一个字母表示，分别为：F,B,L,R。
- 以前DCS设置复杂的进近路线，有一个原因是为了在进近过程中绕开母船本身。在AFS中，认为该问题直接由母船避撞功能代替解决。
- 在AFS，子船互相的避撞范围是固定的50米，不需要设置。而母船的避撞范围是进近点长度的80%，子船在进近过程中，飞往进近点这个过程是考虑避撞的，但最终的对接过程则忽略母船避撞范围。
- 听不懂没关系，我们来实际演示一下这个过程。
- 可见，AFS依然保留了手动设置进近路径这个方向，只不过在设置上尽量简化。为什么不做全自动进近路径选择呢。
- 理论上，程序是可以拿到母船的可用对接口，再发给子船让子船自动运算一条进近路径的。但这个过程，需要由程序做出的判断比较多，程序会比较复杂，或许下个版本我会考虑增加全自动进近路径。
- 最后，说一下配置数据的存储位置与读取程序的写法。
- 在太空工程师中，每个功能方块都有CustomData属性，可以编辑保存一些数据，这些数据会记录在蓝图中。我们就用AFS程序方块的CustomData来保存进近路径和进近姿态配置数据。
- 一个比较好的做法是，程序在启动后，自动在CustomData中写下一份初始配置数据。用户在其中进行修改即可。
- AFS也基本遵照这个方法，但有点特别的是，AFS是在执行到某一个功能时，才会“想起来”需要写配置数据。也即需要先执行一次进近，CustomData中才会出现默认的进近路径和姿态。用户此时可以开始修改。
- 修改完成后，需要recompile重编译AFS，使其读取最新的配置数据。
- 具体执行进近，需要用到三个AFS指令：CONTROL, RADAR:FLYBYON, RADAR:DOCKINGON 
- RADAR:FLYBYON表示开始出发流程，程序启动时，飞船默认是在对接位置，所以平常请在对接位置附近停好飞船，保证飞船可以直飞进近点。
- RADAR:DOCKINGON表示开始着舰流程，如果飞船已处于伴飞位，会开始飞向进近点。
- CONTROL表示中止上述任意流程，飞船改由驾驶员控制。
- 最后，讲一下编程实现的问题，配置数据的读取，DCS是参考别的程序自制了一个配置文件读写类。而AFS则改用了游戏提供的MyIni类，这就减少了代码量，同时配置数据看起来更统一更规范。具体代码如下
- 好的，本期视频就到这里。我们下期再见。