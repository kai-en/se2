每天一个太空工程师编程小知识系列 1，距离与速度
================

这个系列是根据本人新的飞控程序 AFS 的开发进度来的，用来介绍该飞控程序中，相较于之前的DCS的一些改进点。

# 预计制作如下几期
- 第1期 距离与速度
- 第2期 下后双向喷口体系 防侧滑
- 第3期 MyIni与进近路径
- 矢量喷口
- 第4期 瞄准目标数据传输造成的延迟
- 第5期 自动迎击
- 第6期 双向喷口体系在进攻中的表现
- 当然，计划赶不上变化，后续也会根据实际情况增删内容，总之希望保持一个系列的节奏

# 作为第一期 先说下为什么又重开太空工程师这个坑
- 首先当然是因为又没什么吸引我的游戏了，ff14由于固定队太摸，导致我又有很多时间。后续可能会做X4基石，或者 太空谍影2。回来再看吧。
- 其次是太空工程师 自动化这个更新。不编程的玩家可以关注下LSG的Railgun无人机或者类似的东西，好像不编程导弹也有很多做法了。总的来讲这个更新给不编程玩家很多发挥的空间了。
- 但是对我来讲，像摩托坐椅，小对接口这些更能引发我的兴趣，这使得我们可以开发更小型化的无人机。同时如何利用新的AI块的API，比如获取敌对网格上的炮塔的准确位置，以及如何与无编程AI无人机进行对抗也变成了一个非常有意思的题目。
- 我们知道，在自动化DLC更新之前，敌对NPC飞船一直是一个有点无聊的题目。只会规律飞行的大型飞船只是导弹的靶子。而小型飞船则利用海盗API直接锁定玩家。也就是说钓鱼式导弹陷阱就足以完美应付它们。
- 但在新的自动化时代，由于锁敌优先级上本质的变化。大型飞船可以在危险靠近时进行一定的规避。小型飞船也会主动迎击或者规避导弹。由于太空工程师里没有一炸几十米范围的空空导弹连杆战斗部（其实我觉得这种MOD是特别重要的，如果有现成的希望推荐给我）
- 所以现在的无人机对抗，会演变成如何制定和执行克制敌方的“进攻模式”，同时这些模式也会变得更为多样有趣。比如，在面对大量低射速高射程的轨道炮无人机时，利用小无人机机动突破，搭载高射速的加特林应该是一种压制方案。
- 但是面对重甲加特林炮塔刺猬船时，则需要改变策略使用传统的导弹雨。
- 总之，有趣是一个必要的条件，我现在觉得太空工程师在自动化这个更新后肯定会有乐子。

# 第二点，新的AFS和之前的DCS有什么不同
- 总的来讲两者很相似，AFS会优先关注两向喷口体系在自然重力内的使用。同时会对旧的DCS进行一些小优化，无论是代码结构上的还是功能性上。会删除DCS中一些多余的部分，比如双足行走控制啥的。增加轴炮瞄准的部分，以便减少FCS程序块。
- 一个典型的AFS飞行器具有以下特点：1，两向喷口在重力内飞行，2，安装K雷达和天线，以及两个程序块，分别运行雷达目标共享和AFS，不再需要FCS程序块，AFS会兼具FCS的基本功能。
- 从功能性上说，1.0完整版 的AFS飞行器将具有DCS具备的同款功能：1，基于路径的起飞和着舰，2，伴飞模式和攻击模式

# 好的，由于是第一期，背景介绍的部分有点多，下面进入视频的主题，也就是距离与速度
- 像AFS和DCS这种飞行控制程序，基本上是遵照 距离决定速度，速度决定加速度，加速度决定推力。这样的原则来进行运算。这个链条有三部分组成，而后两部分是飞行器本身的结构决定的，比如其最大推力和推重比是多大。但第一部分则可以由算法决定。
- 我需要行进到前方100米的距离，在这个过程中，我的速度曲线是怎样的？如果我要前进1000米，10000米，对应的速度曲线又应该是怎样的？这就是我们要回答的问题
- 之前DCS的想法非常直接，即当前接近速度与距离成正比。比如这个比例是0.1的话，则距离100米，接近速度应该是10，距离1000米，接近速度应该是100，超过1000米也是100，因为速度上限就是100。
- 但是实际操作以及深入的理论分析会发现，这种想法有两个问题。
- 当你距离较远，比如100米时，以10的速度接近，1秒后距离90，速度应下降到9，即每秒需要提供的加速度是1。而在50米时，速度是5，2秒后距离是40，速度应下降到4，则平均每秒需要提供的加速度是1/2只有0.5
- 也就是说，按上述算法，在距离远和距离近时，需要飞行器提供的加速度是不等的。如果飞行器提供的加速度大，则按照上述过程，越接近时其推力剩余就越多，没有很好的利用飞行器的能力，导致整体耗时变长。
- 相反，如果飞行器提供的加速度不够大，则会在距离远时无法进行足够的减速，到近距离了刹不住车，导致碰撞损毁。
- 那么，如果我想让整个飞行过程中，飞行器每个时间点提供的加速度基本一致。则距离和速度的关系应该是什么样的呢。我们知道，定加速度运行的路程公式是 a * t^2 = s 。那对应的，每个位置点上的速度则应该是 v = sqrt(s) * c ，c是一个常量。
- 即设计接近速度应该与距离的平方根成正比。举例，如果系数是1，还是之前的例子，当距离100时，速度应为10，不变，当距离为 81时，速度应为9，（而不是之前90时就降到9）。这样，实现1的减速用掉的距离是100-81 = 19米。飞行器只需要提供0.5左右的加速度即可。
- 同理，距离为64时，速度应为8，从81米到64米，用掉了17米，飞行器需要提供的加速度保持在0.5左右。
- 我们可以观察AFS调试输出的b向数据，如果AFS是向后飞同时减速，则这个数据体现了需要飞行器提供的加速度。如果需要在向前飞时减速，则需要通过抬起机头实现。

# 但是该方法也带来了另一个问题，即近距离下不收敛
- 平方根这个东西，在大于1时是小于输入的，但是小于1时反而会大于输入。此时我们采用了另一个曲线类似但没有那么极端的ln函数取代，在20米以内以ln函数代替平方根函数。
- 好的，在上述理论，以及合适的常量系数的选择下。我们可以看到无论是从极远处靠近，还是在近距离腾挪，AFS都获得了更优的时间效率。一切的关键都在于 速度正比于距离的平方根这样一个神奇的工式。
- 为什么这么重要的理论我时至今日才想通呢，只能怪自己学生时代数学没学好了。

# 好的，本期节目就到这里，相关的代码在视频发布时已更新到工坊作品上，工坊搜索AFS即可。感谢各位的收看，我们下期再见。


l2 autofollow不对
 - m 算的有问题
 - 重力问题？done
有左右推的时候，autofollow要开左右推？no

有l2， af 时sidelimit算错了 done

# 连接中不获取方块
- 自动连接问题？

# 介绍原版导弹

Grid AI Radar System

# 攻击模式
- 检查外部雷达信号是否共享给afs了
- 在目标附近选点
- 靠近目标点